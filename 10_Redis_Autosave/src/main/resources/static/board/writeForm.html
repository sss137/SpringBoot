<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Board Write Form</title>
</head>
<body>

  <h1>Board Write Form (5초마다 임시저장)</h1>
  <form>
    <label for="title">제목</label><br>
    <input type="text" id="title"><br>
    <label for="content">내용</label><br>
    <textarea rows="5" cols="30" id="content"></textarea><br><br>
    <button type="button" onclick="saveBoard()">작성완료</button>
  </form>
  
  <script>
  
    const baseUrl = "/api/boards";
  
    //공통으로 사용할 DOM 요소
    const title = document.getElementById("title");
    const content = document.getElementById("content");
    
    //자동 저장하는 함수
    async function autosave() {
      //title + content => json 문자열로 만들기
      const draft = JSON.stringify({
        title: title.value,
        content: content.value,
      });
      //fetch() 함수로 자동 저장 요청하기
      const response = await fetch(baseUrl + "/autosave", {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          "Accept": "text/plain"
        },
        body: draft
      });
      //응답 결과("Draft Saved!") 받아서 화면에 적절히 출력하기
      if (response.ok) {
        const text = await response.text();
        console.log("Autosave 성공:", text);
      } else {
        const errorText = await response.text();
        alert(`Autosave 실패(${response.status}): ${errorText}`);
      }
    }
  
    //현재 페이지 로드 시 자동 저장된 정보 불러오는 함수
    async function loadDraft() {
      //fetch() 함수로 저장된 정보 요청하기
      const response = await fetch(baseUrl + "/autosave");
      //응답 결과(BoardDTO) 받아서 title, content 입력 상자에 표시하기
      if(response.ok) {
        const draft = await response.json();
        if (draft) {
          title.value = draft.title || "";
          content.value = draft.content || "";
        }
      }
    }
    
    //게시글 저장하기
    async function saveBoard() {
      //저장 요청하기 (BoardDTO 보낼 필요 없음)
      const response = await fetch(baseUrl, {
        method: "POST"
      });
      //응답 결과("Delete Draft!") 받아서 화면에 적절히 출력하기
      if (response.ok) {
        const text = await response.text();
        console.log("Draft Delete 성공:", text);
        title.value = "";
        content.value = "";
      } else {
        const errorText = await response.text();
        alert(`Draft Delete 실패(${response.status}): ${errorText}`);
      }
    }
    
    //자동 저장은 5초마다 호출
    setInterval(autosave, 5 * 1000);
    
    //현재 페이지 로드 시 자동 저장된 정보 불러오기
    loadDraft();
    
  </script>

</body>
</html>